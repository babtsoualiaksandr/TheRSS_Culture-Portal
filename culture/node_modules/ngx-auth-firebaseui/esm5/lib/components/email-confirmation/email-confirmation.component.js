import { __awaiter, __decorate, __generator } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, OnChanges, OnInit, Output, SimpleChanges, TemplateRef, ViewChild } from '@angular/core';
import { Router } from '@angular/router';
import { AuthProcessService } from '../../services';
var defaultTranslations = {
    verifyEmailTitleText: 'Confirm your e-mail address!',
    verifyEmailConfirmationText: 'A confirmation e-mail has been sent.' +
        ' Check your inbox and click on the link "Confirm my e-mail" to confirm your e-mail address.',
    verifyEmailGoBackText: 'Go back',
    sendNewVerificationEmailText: 'Send new confirmation e-mail',
    signOutText: 'Sign out',
    messageOnEmailConfirmationSuccess: 'A new confirmation e-mail has been sent. Please check your inbox.',
};
var EmailConfirmationComponent = /** @class */ (function () {
    function EmailConfirmationComponent(authProcess, router, changeDetectorRef) {
        this.authProcess = authProcess;
        this.router = router;
        this.changeDetectorRef = changeDetectorRef;
        this.signOut = new EventEmitter();
    }
    EmailConfirmationComponent.prototype.ngOnChanges = function (changes) {
        if (changes.verifyEmailTemplate && changes.verifyEmailTemplate.currentValue == null) {
            this.verifyEmailTemplate = this.defaultTemplate;
            console.log('ngOnChanges - defaultTemplate:', this.verifyEmailTemplate);
        }
        this.verifyEmailContext = this.createTemplateContext();
    };
    EmailConfirmationComponent.prototype.ngOnInit = function () {
        if (!this.verifyEmailTemplate) {
            console.log('ngOnInit - defaultTemplate');
            this.verifyEmailTemplate = this.defaultTemplate;
        }
        this.verifyEmailContext = this.createTemplateContext();
        console.log('verifyEmailTemplate:', this.verifyEmailTemplate);
        console.log('verifyEmailContext:', this.verifyEmailContext);
    };
    EmailConfirmationComponent.prototype.continue = function () {
        return __awaiter(this, void 0, void 0, function () {
            var error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        return [4 /*yield*/, this.authProcess.reloadUserInfo()];
                    case 1:
                        _a.sent();
                        return [4 /*yield*/, this.router.navigate([this.goBackURL])];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        error_1 = _a.sent();
                        this.authProcess.notifyError(error_1);
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    EmailConfirmationComponent.prototype.sendNewVerificationEmail = function () {
        return __awaiter(this, void 0, void 0, function () {
            var error_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, 3, 4]);
                        this.isLoading = true;
                        this.changeDetectorRef.markForCheck();
                        return [4 /*yield*/, this.authProcess.sendNewVerificationEmail()];
                    case 1:
                        _a.sent();
                        this.authProcess.showToast(this.verifyEmailContext.messageOnEmailConfirmationSuccess);
                        return [3 /*break*/, 4];
                    case 2:
                        error_2 = _a.sent();
                        this.authProcess.notifyError(error_2);
                        return [3 /*break*/, 4];
                    case 3:
                        this.isLoading = false;
                        this.changeDetectorRef.markForCheck();
                        return [7 /*endfinally*/];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    EmailConfirmationComponent.prototype.createTemplateContext = function () {
        var context = {
            email: this.email,
            goBackURL: this.goBackURL,
            verifyEmailTitleText: this.verifyEmailTitleText || defaultTranslations.verifyEmailTitleText,
            verifyEmailConfirmationText: this.verifyEmailConfirmationText || defaultTranslations.verifyEmailConfirmationText,
            verifyEmailGoBackText: this.verifyEmailGoBackText || defaultTranslations.verifyEmailGoBackText,
            sendNewVerificationEmailText: this.sendNewVerificationEmailText || defaultTranslations.sendNewVerificationEmailText,
            signOutText: this.signOutText || defaultTranslations.signOutText,
            messageOnEmailConfirmationSuccess: this.messageOnEmailConfirmationSuccess || defaultTranslations.messageOnEmailConfirmationSuccess
        };
        return context;
    };
    EmailConfirmationComponent.ctorParameters = function () { return [
        { type: AuthProcessService },
        { type: Router },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "email", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "goBackURL", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailTitleText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailConfirmationText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailGoBackText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "sendNewVerificationEmailText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "signOutText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "messageOnEmailConfirmationSuccess", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "template", void 0);
    __decorate([
        Output()
    ], EmailConfirmationComponent.prototype, "signOut", void 0);
    __decorate([
        ViewChild('defaultVerifyEmail', { static: true })
    ], EmailConfirmationComponent.prototype, "defaultTemplate", void 0);
    EmailConfirmationComponent = __decorate([
        Component({
            selector: 'ngx-auth-firebaseui-email-confirmation',
            template: "<ng-container *ngTemplateOutlet=\"verifyEmailTemplate; context: verifyEmailContext\"></ng-container>\n<ng-template #defaultVerifyEmail let-email=\"email\" let-goBackURL=\"goBackURL\"\n             let-sendNewVerificationEmailText=\"sendNewVerificationEmailText\"\n             let-signOutText=\"signOutText\"\n             let-verifyEmailConfirmationText=\"verifyEmailConfirmationText\" let-verifyEmailGoBackText=\"verifyEmailGoBackText\"\n             let-verifyEmailTitleText=\"verifyEmailTitleText\">\n  <mat-card class=\"verify-email\">\n    <mat-card-content fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <mat-icon>email</mat-icon>\n      <p class=\"title\" fxLayout=\"column\" fxLayoutAlign=\"center center\">\n        <span class=\"mat-subheading-2\">{{ verifyEmailTitleText }}</span>\n        <span class=\"mat-body-2\">{{ email }}</span>\n      </p>\n      <p class=\"subtitle\">{{ verifyEmailConfirmationText }}</p>\n      <mat-progress-bar *ngIf=\"isLoading\" mode=\"indeterminate\"></mat-progress-bar>\n    </mat-card-content>\n    <mat-card-actions fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <button (click)=\"continue()\" *ngIf=\"goBackURL\" class=\"go-back-button action-button\" mat-stroked-button>\n        {{ verifyEmailGoBackText }}\n      </button>\n      <button (click)=\"sendNewVerificationEmail()\" class=\"send-new-mail-button action-button\"\n              mat-stroked-button>{{ sendNewVerificationEmailText }}</button>\n      <button (click)=\"this.signOut.emit()\" class=\"sign-out-button action-button\" color=\"warn\"\n              mat-stroked-button>{{ signOutText }}</button>\n    </mat-card-actions>\n  </mat-card>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [".material-icons{font-size:4rem}.verify-email{width:360px}.verify-email .mat-icon{height:4rem;width:4rem;color:#444}.verify-email .title{margin-top:16px}.verify-email .title .mat-subheading-2{margin-bottom:0}.verify-email .subtitle{margin:16px auto;text-align:justify}.verify-email p{display:block;-webkit-margin-before:1em;-webkit-margin-after:1em;-webkit-margin-start:0;-webkit-margin-end:0}.verify-email mat-card-actions{text-align:center;margin-top:1rem}.verify-email mat-card-actions .action-button{width:100%}.verify-email mat-card-actions .action-button+.action-button{margin-top:1rem}"]
        })
    ], EmailConfirmationComponent);
    return EmailConfirmationComponent;
}());
export { EmailConfirmationComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1hdXRoLWZpcmViYXNldWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9lbWFpbC1jb25maXJtYXRpb24vZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixNQUFNLEVBQ04sYUFBYSxFQUNiLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBWWxELElBQU0sbUJBQW1CLEdBQUc7SUFDMUIsb0JBQW9CLEVBQUUsOEJBQThCO0lBQ3BELDJCQUEyQixFQUFFLHNDQUFzQztRQUNqRSw2RkFBNkY7SUFDL0YscUJBQXFCLEVBQUUsU0FBUztJQUNoQyw0QkFBNEIsRUFBRSw4QkFBOEI7SUFDNUQsV0FBVyxFQUFFLFVBQVU7SUFDdkIsaUNBQWlDLEVBQUUsbUVBQW1FO0NBQ3ZHLENBQUM7QUFRRjtJQTBCRSxvQ0FBbUIsV0FBK0IsRUFBVSxNQUFjLEVBQVUsaUJBQW9DO1FBQXJHLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBWDlHLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBWXZDLENBQUM7SUFFRCxnREFBVyxHQUFYLFVBQVksT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsbUJBQW1CLElBQUksT0FBTyxDQUFDLG1CQUFtQixDQUFDLFlBQVksSUFBSSxJQUFJLEVB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QjtRQUFSLEtBQUssRUFBRTttRkFBcUM7SUFDcEM7UUFBUixLQUFLLEVBQUU7NkVBQStCO0lBQzlCO1FBQVIsS0FBSyxFQUFFO29GQUFzQztJQUNyQztRQUFSLEtBQUssRUFBRTttRUFBcUI7SUFDcEI7UUFBUixLQUFLLEVBQUU7eUZBQTJDO0lBRzFDO1FBQVIsS0FBSyxFQUFFO2dFQUE0QjtJQUUxQjtRQUFULE1BQU0sRUFBRTsrREFBOEI7SUFTVTtRQUFoRCxTQUFTLENBQUMsb0JBQW9CLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUM7dUVBQW1DO0lBeEJ4RSwwQkFBMEI7UUFOdEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHdDQUF3QztZQUNsRCw2cURBQWtEO1lBRWxELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztTQUNoRCxDQUFDO09BQ1csMEJBQTBCLENBbUZ0QztJQUFELGlDQUFDO0NBQUEsQUFuRkQsSUFtRkM7U0FuRlksMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1JvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7QXV0aFByb2Nlc3NTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcyc7XG5cbmludGVyZmFjZSBWZXJpZnlFbWFpbENvbnRleHQge1xuICBlbWFpbDogc3RyaW5nO1xuICBnb0JhY2tVUkw6IHN0cmluZztcbiAgdmVyaWZ5RW1haWxUaXRsZVRleHQ6IHN0cmluZztcbiAgdmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0OiBzdHJpbmc7XG4gIHZlcmlmeUVtYWlsR29CYWNrVGV4dDogc3RyaW5nO1xuICBtZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3M6IHN0cmluZztcbiAgbWVzc2FnZU9uRXJyb3I6IHN0cmluZztcbn1cblxuY29uc3QgZGVmYXVsdFRyYW5zbGF0aW9ucyA9IHtcbiAgdmVyaWZ5RW1haWxUaXRsZVRleHQ6ICdDb25maXJtIHlvdXIgZS1tYWlsIGFkZHJlc3MhJyxcbiAgdmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0OiAnQSBjb25maXJtYXRpb24gZS1tYWlsIGhhcyBiZWVuIHNlbnQuJyArXG4gICAgJyBDaGVjayB5b3VyIGluYm94IGFuZCBjbGljayBvbiB0aGUgbGluayBcIkNvbmZpcm0gbXkgZS1tYWlsXCIgdG8gY29uZmlybSB5b3VyIGUtbWFpbCBhZGRyZXNzLicsXG4gIHZlcmlmeUVtYWlsR29CYWNrVGV4dDogJ0dvIGJhY2snLFxuICBzZW5kTmV3VmVyaWZpY2F0aW9uRW1haWxUZXh0OiAnU2VuZCBuZXcgY29uZmlybWF0aW9uIGUtbWFpbCcsXG4gIHNpZ25PdXRUZXh0OiAnU2lnbiBvdXQnLFxuICBtZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3M6ICdBIG5ldyBjb25maXJtYXRpb24gZS1tYWlsIGhhcyBiZWVuIHNlbnQuIFBsZWFzZSBjaGVjayB5b3VyIGluYm94LicsXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtYXV0aC1maXJlYmFzZXVpLWVtYWlsLWNvbmZpcm1hdGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9lbWFpbC1jb25maXJtYXRpb24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9lbWFpbC1jb25maXJtYXRpb24uY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgRW1haWxDb25maXJtYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgZW1haWw6IHN0cmluZztcbiAgQElucHV0KCkgZ29CYWNrVVJMOiBzdHJpbmc7XG4gIC8vIGkxOG4gdHJhbnNsYXRpb25zIHRvIHVzZSBpbiBkZWZhdWx0IHRlbXBsYXRlXG4gIEBJbnB1dCgpIHZlcmlmeUVtYWlsVGl0bGVUZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dDogc3RyaW5nO1xuICBASW5wdXQoKSB2ZXJpZnlFbWFpbEdvQmFja1RleHQ6IHN0cmluZztcbiAgQElucHV0KCkgc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsVGV4dDogc3RyaW5nO1xuICBASW5wdXQoKSBzaWduT3V0VGV4dDogc3RyaW5nO1xuICBASW5wdXQoKSBtZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3M6IHN0cmluZztcblxuICAvLyBUZW1wbGF0ZSB0byB1c2UgaW4gcGxhY2Ugb2YgZGVmYXVsdCB0ZW1wbGF0ZVxuICBASW5wdXQoKSB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICBAT3V0cHV0KCkgc2lnbk91dCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvLyBGaW5hbCB0ZW1wbGF0ZVxuICB2ZXJpZnlFbWFpbFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICAvLyBDb250ZXh0IGhhc2ggdG8gdXNlIGZvciB2ZXJpZnlFbWFpbFRlbXBsYXRlLlxuICB2ZXJpZnlFbWFpbENvbnRleHQ6IFZlcmlmeUVtYWlsQ29udGV4dDtcblxuICBpc0xvYWRpbmc6IGJvb2xlYW47XG5cbiAgQFZpZXdDaGlsZCgnZGVmYXVsdFZlcmlmeUVtYWlsJywge3N0YXRpYzogdHJ1ZX0pIGRlZmF1bHRUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgYXV0aFByb2Nlc3M6IEF1dGhQcm9jZXNzU2VydmljZSwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy52ZXJpZnlFbWFpbFRlbXBsYXRlICYmIGNoYW5nZXMudmVyaWZ5RW1haWxUZW1wbGF0ZS5jdXJyZW50VmFsdWUgPT0gbnVsbCkge1xuICAgICAgdGhpcy52ZXJpZnlFbWFpbFRlbXBsYXRlID0gdGhpcy5kZWZhdWx0VGVtcGxhdGU7XG4gICAgICBjb25zb2xlLmxvZygnbmdPbkNoYW5nZXMgLSBkZWZhdWx0VGVtcGxhdGU6JywgdGhpcy52ZXJpZnlFbWFpbFRlbXBsYXRlKTtcbiAgICB9XG4gICAgdGhpcy52ZXJpZnlFbWFpbENvbnRleHQgPSB0aGlzLmNyZWF0ZVRlbXBsYXRlQ29udGV4dCgpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnZlcmlmeUVtYWlsVGVtcGxhdGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCduZ09uSW5pdCAtIGRlZmF1bHRUZW1wbGF0ZScpO1xuICAgICAgdGhpcy52ZXJpZnlFbWFpbFRlbXBsYXRlID0gdGhpcy5kZWZhdWx0VGVtcGxhdGU7XG4gICAgfVxuICAgIHRoaXMudmVyaWZ5RW1haWxDb250ZXh0ID0gdGhpcy5jcmVhdGVUZW1wbGF0ZUNvbnRleHQoKTtcbiAgICBjb25zb2xlLmxvZygndmVyaWZ5RW1haWxUZW1wbGF0ZTonLCB0aGlzLnZlcmlmeUVtYWlsVGVtcGxhdGUpO1xuICAgIGNvbnNvbGUubG9nKCd2ZXJpZnlFbWFpbENvbnRleHQ6JywgdGhpcy52ZXJpZnlFbWFpbENvbnRleHQpO1xuICB9XG5cbiAgYXN5bmMgY29udGludWUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYXV0aFByb2Nlc3MucmVsb2FkVXNlckluZm8oKTtcbiAgICAgIGF3YWl0IHRoaXMucm91dGVyLm5hdmlnYXRlKFt0aGlzLmdvQmFja1VSTF0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmF1dGhQcm9jZXNzLm5vdGlmeUVycm9yKGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZW5kTmV3VmVyaWZpY2F0aW9uRW1haWwoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgICBhd2FpdCB0aGlzLmF1dGhQcm9jZXNzLnNlbmROZXdWZXJpZmljYXRpb25FbWFpbCgpO1xuICAgICAgdGhpcy5hdXRoUHJvY2Vzcy5zaG93VG9hc3QodGhpcy52ZXJpZnlFbWFpbENvbnRleHQubWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5hdXRoUHJvY2Vzcy5ub3RpZnlFcnJvcihlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVGVtcGxhdGVDb250ZXh0KCk6IGFueSB7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgIGVtYWlsOiB0aGlzLmVtYWlsLFxuICAgICAgZ29CYWNrVVJMOiB0aGlzLmdvQmFja1VSTCxcbiAgICAgIHZlcmlmeUVtYWlsVGl0bGVUZXh0OiB0aGlzLnZlcmlmeUVtYWlsVGl0bGVUZXh0IHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMudmVyaWZ5RW1haWxUaXRsZVRleHQsXG4gICAgICB2ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQ6IHRoaXMudmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0IHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMudmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0LFxuICAgICAgdmVyaWZ5RW1haWxHb0JhY2tUZXh0OiB0aGlzLnZlcmlmeUVtYWlsR29CYWNrVGV4dCB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLnZlcmlmeUVtYWlsR29CYWNrVGV4dCxcbiAgICAgIHNlbmROZXdWZXJpZmljYXRpb25FbWFpbFRleHQ6IHRoaXMuc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsVGV4dCB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLnNlbmROZXdWZXJpZmljYXRpb25FbWFpbFRleHQsXG4gICAgICBzaWduT3V0VGV4dDogdGhpcy5zaWduT3V0VGV4dCB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLnNpZ25PdXRUZXh0LFxuICAgICAgbWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzOiB0aGlzLm1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2VzcyB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLm1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2Vzc1xuICAgIH07XG4gICAgcmV0dXJuIGNvbnRleHQ7XG4gIH1cbn1cbiJdfQ==