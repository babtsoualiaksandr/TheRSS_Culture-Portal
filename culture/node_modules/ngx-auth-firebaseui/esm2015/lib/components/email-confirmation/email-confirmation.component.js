import { __awaiter, __decorate } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, OnChanges, OnInit, Output, SimpleChanges, TemplateRef, ViewChild } from '@angular/core';
import { Router } from '@angular/router';
import { AuthProcessService } from '../../services';
const defaultTranslations = {
    verifyEmailTitleText: 'Confirm your e-mail address!',
    verifyEmailConfirmationText: 'A confirmation e-mail has been sent.' +
        ' Check your inbox and click on the link "Confirm my e-mail" to confirm your e-mail address.',
    verifyEmailGoBackText: 'Go back',
    sendNewVerificationEmailText: 'Send new confirmation e-mail',
    signOutText: 'Sign out',
    messageOnEmailConfirmationSuccess: 'A new confirmation e-mail has been sent. Please check your inbox.',
};
let EmailConfirmationComponent = class EmailConfirmationComponent {
    constructor(authProcess, router, changeDetectorRef) {
        this.authProcess = authProcess;
        this.router = router;
        this.changeDetectorRef = changeDetectorRef;
        this.signOut = new EventEmitter();
    }
    ngOnChanges(changes) {
        if (changes.verifyEmailTemplate && changes.verifyEmailTemplate.currentValue == null) {
            this.verifyEmailTemplate = this.defaultTemplate;
            console.log('ngOnChanges - defaultTemplate:', this.verifyEmailTemplate);
        }
        this.verifyEmailContext = this.createTemplateContext();
    }
    ngOnInit() {
        if (!this.verifyEmailTemplate) {
            console.log('ngOnInit - defaultTemplate');
            this.verifyEmailTemplate = this.defaultTemplate;
        }
        this.verifyEmailContext = this.createTemplateContext();
        console.log('verifyEmailTemplate:', this.verifyEmailTemplate);
        console.log('verifyEmailContext:', this.verifyEmailContext);
    }
    continue() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.authProcess.reloadUserInfo();
                yield this.router.navigate([this.goBackURL]);
            }
            catch (error) {
                this.authProcess.notifyError(error);
            }
        });
    }
    sendNewVerificationEmail() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                this.isLoading = true;
                this.changeDetectorRef.markForCheck();
                yield this.authProcess.sendNewVerificationEmail();
                this.authProcess.showToast(this.verifyEmailContext.messageOnEmailConfirmationSuccess);
            }
            catch (error) {
                this.authProcess.notifyError(error);
            }
            finally {
                this.isLoading = false;
                this.changeDetectorRef.markForCheck();
            }
        });
    }
    createTemplateContext() {
        const context = {
            email: this.email,
            goBackURL: this.goBackURL,
            verifyEmailTitleText: this.verifyEmailTitleText || defaultTranslations.verifyEmailTitleText,
            verifyEmailConfirmationText: this.verifyEmailConfirmationText || defaultTranslations.verifyEmailConfirmationText,
            verifyEmailGoBackText: this.verifyEmailGoBackText || defaultTranslations.verifyEmailGoBackText,
            sendNewVerificationEmailText: this.sendNewVerificationEmailText || defaultTranslations.sendNewVerificationEmailText,
            signOutText: this.signOutText || defaultTranslations.signOutText,
            messageOnEmailConfirmationSuccess: this.messageOnEmailConfirmationSuccess || defaultTranslations.messageOnEmailConfirmationSuccess
        };
        return context;
    }
};
EmailConfirmationComponent.ctorParameters = () => [
    { type: AuthProcessService },
    { type: Router },
    { type: ChangeDetectorRef }
];
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "email", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "goBackURL", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "verifyEmailTitleText", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "verifyEmailConfirmationText", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "verifyEmailGoBackText", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "sendNewVerificationEmailText", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "signOutText", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "messageOnEmailConfirmationSuccess", void 0);
__decorate([
    Input()
], EmailConfirmationComponent.prototype, "template", void 0);
__decorate([
    Output()
], EmailConfirmationComponent.prototype, "signOut", void 0);
__decorate([
    ViewChild('defaultVerifyEmail', { static: true })
], EmailConfirmationComponent.prototype, "defaultTemplate", void 0);
EmailConfirmationComponent = __decorate([
    Component({
        selector: 'ngx-auth-firebaseui-email-confirmation',
        template: "<ng-container *ngTemplateOutlet=\"verifyEmailTemplate; context: verifyEmailContext\"></ng-container>\n<ng-template #defaultVerifyEmail let-email=\"email\" let-goBackURL=\"goBackURL\"\n             let-sendNewVerificationEmailText=\"sendNewVerificationEmailText\"\n             let-signOutText=\"signOutText\"\n             let-verifyEmailConfirmationText=\"verifyEmailConfirmationText\" let-verifyEmailGoBackText=\"verifyEmailGoBackText\"\n             let-verifyEmailTitleText=\"verifyEmailTitleText\">\n  <mat-card class=\"verify-email\">\n    <mat-card-content fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <mat-icon>email</mat-icon>\n      <p class=\"title\" fxLayout=\"column\" fxLayoutAlign=\"center center\">\n        <span class=\"mat-subheading-2\">{{ verifyEmailTitleText }}</span>\n        <span class=\"mat-body-2\">{{ email }}</span>\n      </p>\n      <p class=\"subtitle\">{{ verifyEmailConfirmationText }}</p>\n      <mat-progress-bar *ngIf=\"isLoading\" mode=\"indeterminate\"></mat-progress-bar>\n    </mat-card-content>\n    <mat-card-actions fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <button (click)=\"continue()\" *ngIf=\"goBackURL\" class=\"go-back-button action-button\" mat-stroked-button>\n        {{ verifyEmailGoBackText }}\n      </button>\n      <button (click)=\"sendNewVerificationEmail()\" class=\"send-new-mail-button action-button\"\n              mat-stroked-button>{{ sendNewVerificationEmailText }}</button>\n      <button (click)=\"this.signOut.emit()\" class=\"sign-out-button action-button\" color=\"warn\"\n              mat-stroked-button>{{ signOutText }}</button>\n    </mat-card-actions>\n  </mat-card>\n</ng-template>\n",
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".material-icons{font-size:4rem}.verify-email{width:360px}.verify-email .mat-icon{height:4rem;width:4rem;color:#444}.verify-email .title{margin-top:16px}.verify-email .title .mat-subheading-2{margin-bottom:0}.verify-email .subtitle{margin:16px auto;text-align:justify}.verify-email p{display:block;-webkit-margin-before:1em;-webkit-margin-after:1em;-webkit-margin-start:0;-webkit-margin-end:0}.verify-email mat-card-actions{text-align:center;margin-top:1rem}.verify-email mat-card-actions .action-button{width:100%}.verify-email mat-card-actions .action-button+.action-button{margin-top:1rem}"]
    })
], EmailConfirmationComponent);
export { EmailConfirmationComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1hdXRoLWZpcmViYXNldWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9lbWFpbC1jb25maXJtYXRpb24vZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixNQUFNLEVBQ04sYUFBYSxFQUNiLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBWWxELE1BQU0sbUJBQW1CLEdBQUc7SUFDMUIsb0JBQW9CLEVBQUUsOEJBQThCO0lBQ3BELDJCQUEyQixFQUFFLHNDQUFzQztRQUNqRSw2RkFBNkY7SUFDL0YscUJBQXFCLEVBQUUsU0FBUztJQUNoQyw0QkFBNEIsRUFBRSw4QkFBOEI7SUFDNUQsV0FBVyxFQUFFLFVBQVU7SUFDdkIsaUNBQWlDLEVBQUUsbUVBQW1FO0NBQ3ZHLENBQUM7QUFRRixJQUFhLDBCQUEwQixHQUF2QyxNQUFhLDBCQUEwQjtJQTBCckMsWUFBbUIsV0FBK0IsRUFBVSxNQUFjLEVBQVUsaUJBQW9DO1FBQXJHLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBWDlHLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBWXZDLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsbUJBQW1CLElBQUksT0FBTyxDQUFDLG1CQUFt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QUFFbEI7SUFBUixLQUFLLEVBQUU7d0VBQThCO0FBQzdCO0lBQVIsS0FBSyxFQUFFOytFQUFxQztBQUNwQztJQUFSLEtBQUssRUFBRTt5RUFBK0I7QUFDOUI7SUFBUixLQUFLLEVBQUU7Z0ZBQXNDO0FBQ3JDO0lBQVIsS0FBSyxFQUFFOytEQUFxQjtBQUNwQjtJQUFSLEtBQUssRUFBRTtxRkFBMkM7QUFHMUM7SUFBUixLQUFLLEVBQUU7NERBQTRCO0FBRTFCO0lBQVQsTUFBTSxFQUFFOzJEQUE4QjtBQVNVO0lBQWhELFNBQVMsQ0FBQyxvQkFBb0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQzttRUFBbUM7QUF4QnhFLDBCQUEwQjtJQU50QyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsd0NBQXdDO1FBQ2xELDZxREFBa0Q7UUFFbEQsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O0tBQ2hELENBQUM7R0FDVywwQkFBMEIsQ0FtRnRDO1NBbkZZLDBCQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtSb3V0ZXJ9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQge0F1dGhQcm9jZXNzU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMnO1xuXG5pbnRlcmZhY2UgVmVyaWZ5RW1haWxDb250ZXh0IHtcbiAgZW1haWw6IHN0cmluZztcbiAgZ29CYWNrVVJMOiBzdHJpbmc7XG4gIHZlcmlmeUVtYWlsVGl0bGVUZXh0OiBzdHJpbmc7XG4gIHZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dDogc3RyaW5nO1xuICB2ZXJpZnlFbWFpbEdvQmFja1RleHQ6IHN0cmluZztcbiAgbWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzOiBzdHJpbmc7XG4gIG1lc3NhZ2VPbkVycm9yOiBzdHJpbmc7XG59XG5cbmNvbnN0IGRlZmF1bHRUcmFuc2xhdGlvbnMgPSB7XG4gIHZlcmlmeUVtYWlsVGl0bGVUZXh0OiAnQ29uZmlybSB5b3VyIGUtbWFpbCBhZGRyZXNzIScsXG4gIHZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dDogJ0EgY29uZmlybWF0aW9uIGUtbWFpbCBoYXMgYmVlbiBzZW50LicgK1xuICAgICcgQ2hlY2sgeW91ciBpbmJveCBhbmQgY2xpY2sgb24gdGhlIGxpbmsgXCJDb25maXJtIG15IGUtbWFpbFwiIHRvIGNvbmZpcm0geW91ciBlLW1haWwgYWRkcmVzcy4nLFxuICB2ZXJpZnlFbWFpbEdvQmFja1RleHQ6ICdHbyBiYWNrJyxcbiAgc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsVGV4dDogJ1NlbmQgbmV3IGNvbmZpcm1hdGlvbiBlLW1haWwnLFxuICBzaWduT3V0VGV4dDogJ1NpZ24gb3V0JyxcbiAgbWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzOiAnQSBuZXcgY29uZmlybWF0aW9uIGUtbWFpbCBoYXMgYmVlbiBzZW50LiBQbGVhc2UgY2hlY2sgeW91ciBpbmJveC4nLFxufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWF1dGgtZmlyZWJhc2V1aS1lbWFpbC1jb25maXJtYXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIEVtYWlsQ29uZmlybWF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIGVtYWlsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGdvQmFja1VSTDogc3RyaW5nO1xuICAvLyBpMThuIHRyYW5zbGF0aW9ucyB0byB1c2UgaW4gZGVmYXVsdCB0ZW1wbGF0ZVxuICBASW5wdXQoKSB2ZXJpZnlFbWFpbFRpdGxlVGV4dDogc3RyaW5nO1xuICBASW5wdXQoKSB2ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgdmVyaWZ5RW1haWxHb0JhY2tUZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHNlbmROZXdWZXJpZmljYXRpb25FbWFpbFRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgc2lnbk91dFRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgbWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzOiBzdHJpbmc7XG5cbiAgLy8gVGVtcGxhdGUgdG8gdXNlIGluIHBsYWNlIG9mIGRlZmF1bHQgdGVtcGxhdGVcbiAgQElucHV0KCkgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgQE91dHB1dCgpIHNpZ25PdXQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLy8gRmluYWwgdGVtcGxhdGVcbiAgdmVyaWZ5RW1haWxUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgLy8gQ29udGV4dCBoYXNoIHRvIHVzZSBmb3IgdmVyaWZ5RW1haWxUZW1wbGF0ZS5cbiAgdmVyaWZ5RW1haWxDb250ZXh0OiBWZXJpZnlFbWFpbENvbnRleHQ7XG5cbiAgaXNMb2FkaW5nOiBib29sZWFuO1xuXG4gIEBWaWV3Q2hpbGQoJ2RlZmF1bHRWZXJpZnlFbWFpbCcsIHtzdGF0aWM6IHRydWV9KSBkZWZhdWx0VGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgY29uc3RydWN0b3IocHVibGljIGF1dGhQcm9jZXNzOiBBdXRoUHJvY2Vzc1NlcnZpY2UsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMudmVyaWZ5RW1haWxUZW1wbGF0ZSAmJiBjaGFuZ2VzLnZlcmlmeUVtYWlsVGVtcGxhdGUuY3VycmVudFZhbHVlID09IG51bGwpIHtcbiAgICAgIHRoaXMudmVyaWZ5RW1haWxUZW1wbGF0ZSA9IHRoaXMuZGVmYXVsdFRlbXBsYXRlO1xuICAgICAgY29uc29sZS5sb2coJ25nT25DaGFuZ2VzIC0gZGVmYXVsdFRlbXBsYXRlOicsIHRoaXMudmVyaWZ5RW1haWxUZW1wbGF0ZSk7XG4gICAgfVxuICAgIHRoaXMudmVyaWZ5RW1haWxDb250ZXh0ID0gdGhpcy5jcmVhdGVUZW1wbGF0ZUNvbnRleHQoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy52ZXJpZnlFbWFpbFRlbXBsYXRlKSB7XG4gICAgICBjb25zb2xlLmxvZygnbmdPbkluaXQgLSBkZWZhdWx0VGVtcGxhdGUnKTtcbiAgICAgIHRoaXMudmVyaWZ5RW1haWxUZW1wbGF0ZSA9IHRoaXMuZGVmYXVsdFRlbXBsYXRlO1xuICAgIH1cbiAgICB0aGlzLnZlcmlmeUVtYWlsQ29udGV4dCA9IHRoaXMuY3JlYXRlVGVtcGxhdGVDb250ZXh0KCk7XG4gICAgY29uc29sZS5sb2coJ3ZlcmlmeUVtYWlsVGVtcGxhdGU6JywgdGhpcy52ZXJpZnlFbWFpbFRlbXBsYXRlKTtcbiAgICBjb25zb2xlLmxvZygndmVyaWZ5RW1haWxDb250ZXh0OicsIHRoaXMudmVyaWZ5RW1haWxDb250ZXh0KTtcbiAgfVxuXG4gIGFzeW5jIGNvbnRpbnVlKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmF1dGhQcm9jZXNzLnJlbG9hZFVzZXJJbmZvKCk7XG4gICAgICBhd2FpdCB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbdGhpcy5nb0JhY2tVUkxdKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5hdXRoUHJvY2Vzcy5ub3RpZnlFcnJvcihlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsKCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgYXdhaXQgdGhpcy5hdXRoUHJvY2Vzcy5zZW5kTmV3VmVyaWZpY2F0aW9uRW1haWwoKTtcbiAgICAgIHRoaXMuYXV0aFByb2Nlc3Muc2hvd1RvYXN0KHRoaXMudmVyaWZ5RW1haWxDb250ZXh0Lm1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2Vzcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuYXV0aFByb2Nlc3Mubm90aWZ5RXJyb3IoZXJyb3IpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRlbXBsYXRlQ29udGV4dCgpOiBhbnkge1xuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICBlbWFpbDogdGhpcy5lbWFpbCxcbiAgICAgIGdvQmFja1VSTDogdGhpcy5nb0JhY2tVUkwsXG4gICAgICB2ZXJpZnlFbWFpbFRpdGxlVGV4dDogdGhpcy52ZXJpZnlFbWFpbFRpdGxlVGV4dCB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLnZlcmlmeUVtYWlsVGl0bGVUZXh0LFxuICAgICAgdmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0OiB0aGlzLnZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dCB8fCBkZWZhdWx0VHJhbnNsYXRpb25zLnZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dCxcbiAgICAgIHZlcmlmeUVtYWlsR29CYWNrVGV4dDogdGhpcy52ZXJpZnlFbWFpbEdvQmFja1RleHQgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy52ZXJpZnlFbWFpbEdvQmFja1RleHQsXG4gICAgICBzZW5kTmV3VmVyaWZpY2F0aW9uRW1haWxUZXh0OiB0aGlzLnNlbmROZXdWZXJpZmljYXRpb25FbWFpbFRleHQgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy5zZW5kTmV3VmVyaWZpY2F0aW9uRW1haWxUZXh0LFxuICAgICAgc2lnbk91dFRleHQ6IHRoaXMuc2lnbk91dFRleHQgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy5zaWduT3V0VGV4dCxcbiAgICAgIG1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2VzczogdGhpcy5tZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3MgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy5tZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3NcbiAgICB9O1xuICAgIHJldHVybiBjb250ZXh0O1xuICB9XG59XG4iXX0=